apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-config
  namespace: monitoring
  labels:
    app: grafana
data:
  grafana.ini: |
    [server]
    http_port = 3001
    domain = localhost
    
    [security]
    admin_user = admin
    admin_password = admin
    
    [auth.anonymous]
    enabled = true
    org_name = Main Org.
    org_role = Viewer
    
    [database]
    type = sqlite3
    path = /var/lib/grafana/grafana.db
    
    [session]
    provider = file
    provider_config = sessions
    
    [log]
    mode = console
    level = info
    
    [metrics]
    enabled = true
    interval_seconds = 10
    
    [alerting]
    enabled = true
    execute_alerts = true
    
    [unified_alerting]
    enabled = true
    
    [feature_toggles]
    enable = publicDashboards
    
  datasources.yaml: |
    apiVersion: 1
    
    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://monitoring-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090
        isDefault: true
        editable: true
        jsonData:
          timeInterval: "30s"
          queryTimeout: "60s"
          httpMethod: "POST"
        secureJsonData: {}
        
      - name: Loki
        type: loki
        access: proxy
        url: http://loki.monitoring.svc.cluster.local:3100
        editable: true
        jsonData:
          maxLines: 1000
        secureJsonData: {}
        
      - name: Elasticsearch
        type: elasticsearch
        access: proxy
        url: http://elasticsearch.monitoring.svc.cluster.local:9200
        editable: true
        jsonData:
          timeField: "@timestamp"
          esVersion: 7.0.0
          maxConcurrentShardRequests: 5
          logMessageField: message
          logLevelField: level
        secureJsonData: {}
        
  dashboards.yaml: |
    apiVersion: 1
    
    providers:
      - name: 'devops-ai-platform'
        orgId: 1
        folder: 'DevOps AI Platform'
        type: file
        disableDeletion: false
        updateIntervalSeconds: 30
        allowUiUpdates: true
        options:
          path: /var/lib/grafana/dashboards
          
  notifications.yaml: |
    apiVersion: 1
    
    notifiers:
      - name: Slack Alerts
        type: slack
        uid: slack_alerts
        org_id: 1
        is_default: false
        settings:
          url: "https://hooks.slack.com/services/YOUR_SLACK_WEBHOOK"
          recipient: "#devops-alerts"
          mentionChannel: "here"
          mentionUsers: ""
          token: ""
        secure_settings:
          url: ""
        send_reminder: true
        frequency: "1m"
        disable_resolve_message: false
        
      - name: Email Alerts
        type: email
        uid: email_alerts
        org_id: 1
        is_default: false
        settings:
          addresses: "devops-team@company.com"
        secure_settings: {}
        send_reminder: true
        frequency: "1m"
        disable_resolve_message: false
        
      - name: Telegram Alerts
        type: telegram
        uid: telegram_alerts
        org_id: 1
        is_default: false
        settings:
          bottoken: "YOUR_TELEGRAM_BOT_TOKEN"
          chatid: "YOUR_TELEGRAM_CHAT_ID"
        secure_settings: {}
        send_reminder: true
        frequency: "1m"
        disable_resolve_message: false
